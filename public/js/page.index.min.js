$(function(){var r={xhr:!1,pagination:1,limit:30,endofrecord:!1,currentSearch:"camping"};function i(t){if(!r.endofrecord){var e=new ReiEinstein.Api;n(),r.xhr=!0,e.fetchProducts(r.currentSearch,r.pagination,r.limit).done(function(e){var n,i;e.length?(n=e,i=t,$.when($.ajax({url:"templates/products.mst",dataType:"text"})).done(function(e){Mustache.parse(e);var t=$(Mustache.render(e,{items:n}));i?$("#itemsList").html(t):$("#itemsList").append(t)}),r.pagination++,r.xhr=!1):a()}).fail(a).always(function(){o(),$("#searchTitle").html('Results for "'+r.currentSearch+'"')})}function a(e){r.xhr=!1,r.endofrecord=!0,1==r.pagination&&t&&$("#itemsList").html("<li><h2>No Data Found</h2></li>")}}function n(){$("#loader").length||$("#itemsWrapper").append('<div class="loader" id="loader"></div>')}function o(){$("#itemsWrapper #loader").remove()}$(window).on("scroll",function(){e=$(document).scrollTop(),t=$(window).height(),n=$(document).height()-t,.9<e/n&&!r.xhr&&i(!1);var e,t,n}).scroll(),$("header").on("submit",'form[name="search-form"]',function(e){e.preventDefault();var t=$(this).find('input[name="search"]').val();r.xhr=!1,r.pagination=1,r.endofrecord=!1,$("#itemsList").html(""),n(),r.currentSearch=t,(new ReiEinstein.Api).fetchIntent(r.currentSearch).done(function(e){switch(e.intent.label){case"Shopping":i(!0);break;default:o(),a=e,$.when($.ajax({url:"templates/einstein-intent.mst",dataType:"text"})).done(function(e){var t=(100*a.einstein_response.probabilities[0].probability).toFixed(2);Mustache.parse(e);var n={link:a.intent.link,thumbnailImageLink:a.intent.image,title:"something",brand:a.intent.label,text:"Einstein Intent matches "+a.intent.label+" with "+t+"% probability"},i=$(Mustache.render(e,n));$("#itemsList").html(i)}),i(!1)}var a}).fail(function(){i(!0)})}),i(!0)});