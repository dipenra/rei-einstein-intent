$(function(){var a={xhr:!1,pagination:1,limit:30,endofrecord:!1,currentSearch:"camping"};function r(t){if(!a.endofrecord){var e=new ReiEinstein.Api;i(),a.xhr=!0,e.fetchProducts(a.currentSearch,a.pagination,a.limit).done(function(e){var n,i;n=e,i=t,$.when($.ajax({url:"templates/products.mst",dataType:"text"})).done(function(e){Mustache.parse(e);var t=$(Mustache.render(e,{items:n}));i?$("#itemsList").html(t):$("#itemsList").append(t)}),a.pagination++,a.xhr=!1}).fail(function(e){a.xhr=!1,a.endofrecord=!0,1==a.pagination&&t&&$("#itemsList").html("<li><h2>No Data Found</h2></li>")}).always(function(){o(),$("#searchTitle").html('Results for "'+a.currentSearch+'"')})}}function i(){$("#loader").length||$("#itemsWrapper").append('<div class="loader" id="loader"></div>')}function o(){$("#itemsWrapper #loader").remove()}$(window).on("scroll",function(){e=$(document).scrollTop(),t=$(window).height(),n=$(document).height()-t,.9<e/n&&!a.xhr&&r(!1);var e,t,n}).scroll(),$("header").on("submit",'form[name="search-form"]',function(e){e.preventDefault();var t=$(this).find('input[name="search"]').val(),n=new ReiEinstein.Api;a.xhr=!1,a.pagination=1,a.endofrecord=!1,$("#itemsList").html(""),i(),a.currentSearch=t,n.fetchIntent(t).done(function(e){switch(e.intent.label){case"Shopping":r(!0);break;default:o(),i=e,$.when($.ajax({url:"templates/einstein-intent.mst",dataType:"text"})).done(function(e){Mustache.parse(e);var t={link:i.intent.link,thumbnailImageLink:i.intent.image,title:"something",brand:i.intent.label,text:"Einstein Intent matches "+i.intent.label+" with "+i.einstein_response.probabilities[0].probability+" probability"},n=$(Mustache.render(e,t));$("#itemsList").html(n)}),r(!1)}var i}).fail(function(){r(!0)})}),r(!0)});