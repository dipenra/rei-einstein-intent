$(function(){var a={xhr:!1,pagination:1,limit:30,endofrecord:!1,currentSearch:"camping gears"};function i(n){if(!a.endofrecord){var e=new ReiEinstein.Api;r(),a.xhr=!0,e.fetchProducts(a.currentSearch,a.pagination,a.limit).done(function(e){var t,i;t=e,i=n,$.when($.ajax({url:"templates/products.mst",dataType:"text"})).done(function(e){Mustache.parse(e);var n=$(Mustache.render(e,{items:t}));i?$("#itemsList").html(n):$("#itemsList").append(n)}),a.pagination++,a.xhr=!1}).fail(function(e){a.xhr=!1,a.endofrecord=!0,1==a.pagination&&$("#itemsList").html("<li><h2>No Data Found</h2></li>")}).always(function(){o(),$("#searchTitle").html('Results for "'+a.currentSearch+'"')})}}function r(){$("#loader").length||$("#itemsWrapper").append('<div class="loader" id="loader"></div>')}function o(){$("#itemsWrapper #loader").remove()}$(window).on("scroll",function(){e=$(document).scrollTop(),n=$(window).height(),t=$(document).height()-n,.9<e/t&&!a.xhr&&i(!1);var e,n,t}).scroll(),$("header").on("submit",'form[name="search-form"]',function(e){e.preventDefault();var n=$(this).find('input[name="search"]').val(),t=new ReiEinstein.Api;a.xhr=!1,a.pagination=1,a.endofrecord=!1,$("#itemsList").html(""),r(),a.currentSearch=n,t.fetchIntent(n).done(function(e){switch(e.intent){case"Shopping":i(!0);break;default:o(),e,$.when($.ajax({url:"templates/einstein-intent.mst",dataType:"text"})).done(function(e){Mustache.parse(e);var n={link:"http://cnn.com",thumbnailImageLink:"/images/hiking.jpg",title:"something",brand:"mountain biking"},t=$(Mustache.render(e,n));$("#itemsList").html(t)}),i(!1)}}).fail(function(){i(!0)})}),i(!0)});